const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DemandCharts-CzDTzhTK.js","assets/react-BBjJjj3s.js","assets/vendor-BSC4DWPL.js","assets/recharts-s-AJNvpF.js","assets/three-s7DBp6_P.js","assets/radix-Dv_jxVmT.js","assets/xlsx-uoQkVabA.js","assets/POGenerator-CCGm8kQd.js","assets/KPIOrbit-DZdMRtOU.js"])))=>i.map(i=>d[i]);
var vt=Object.defineProperty;var St=(a,t,s)=>t in a?vt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var be=(a,t,s)=>St(a,typeof t!="symbol"?t+"":t,s);import{r as x,j as e,l as Ct,R as kt}from"./react-BBjJjj3s.js";import{u as Ve,C as wt,V as pe,_ as Oe}from"./three-s7DBp6_P.js";import{av as Dt,z as Ot,aw as $e,ax as Pt,ay as Mt,az as ke,aA as Pe,aB as Lt,aC as Tt,aD as we,aE as At,aF as It,aG as Rt,aH as X,aI as fe,aJ as ze,aK as Bt,aL as Me,aM as _t,aN as Le,aO as Qt,aP as Fe,aQ as ve,aR as Se}from"./vendor-BSC4DWPL.js";import{S as Et,L as qe,T as He,C as Ke,R as Ft,a as We,I as Ut,P as Vt,b as Ge,V as $t,c as Ye,d as Je,e as zt,f as qt,g as Xe,h as Ze,i as et,j as Ht,k as Kt,l as tt,m as st,n as Wt,o as at,p as rt,q as nt,r as ot,s as lt,t as it,u as ct,v as Gt,w as Yt,x as dt,y as Jt}from"./radix-Dv_jxVmT.js";import{r as Xt,u as K,w as Zt}from"./xlsx-uoQkVabA.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}})();function v(...a){return Dt(Ot(a))}const es=$e("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),$=x.forwardRef(({className:a,variant:t,size:s,asChild:n=!1,...o},l)=>{const d=n?Et:"button";return e.jsx(d,{className:v(es({variant:t,size:s,className:a})),ref:l,...o})});$.displayName="Button";const Z=x.forwardRef(({className:a,type:t,...s},n)=>e.jsx("input",{type:t,className:v("soft-input flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:n,...s}));Z.displayName="Input";const ts=Ft,ut=x.forwardRef(({className:a,...t},s)=>e.jsx(qe,{ref:s,className:v("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...t}));ut.displayName=qe.displayName;const Y=x.forwardRef(({className:a,...t},s)=>e.jsx(He,{ref:s,className:v("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",a),...t}));Y.displayName=He.displayName;const J=x.forwardRef(({className:a,...t},s)=>e.jsx(Ke,{ref:s,className:v("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...t}));J.displayName=Ke.displayName;const ae=x.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:v("soft-card rounded-lg border bg-card text-card-foreground shadow-sm",a),...t}));ae.displayName="Card";const re=x.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:v("flex flex-col space-y-1.5 p-6",a),...t}));re.displayName="CardHeader";const ne=x.forwardRef(({className:a,...t},s)=>e.jsx("h3",{ref:s,className:v("text-2xl font-semibold leading-none tracking-tight",a),...t}));ne.displayName="CardTitle";const ss=x.forwardRef(({className:a,...t},s)=>e.jsx("p",{ref:s,className:v("text-sm text-muted-foreground",a),...t}));ss.displayName="CardDescription";const oe=x.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:v("p-6 pt-0",a),...t}));oe.displayName="CardContent";const as=x.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:v("flex items-center p-6 pt-0",a),...t}));as.displayName="CardFooter";const rs=$e("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function q({className:a,variant:t,...s}){return e.jsx("div",{className:v(rs({variant:t}),a),...s})}function ns(a){return new Promise((t,s)=>{const n=new FileReader;n.onload=o=>{var l;try{const d=(l=o.target)==null?void 0:l.result,c=new Uint8Array(d),m=Xt(c,{type:"array"}),h={};m.SheetNames.forEach(u=>{const N=m.Sheets[u];h[u]=K.sheet_to_json(N,{defval:""})}),t({sheets:h,arrayBuffer:d})}catch(d){s(d)}},n.onerror=()=>s(new Error("Failed to read file")),n.readAsArrayBuffer(a)})}function os(a,t){const s=Object.keys(a),n=t.toLowerCase();if(s.some(l=>l.toLowerCase().includes("proc")&&l.toLowerCase().includes("forecast"))||s.some(l=>l.toLowerCase().includes("supplier master"))||s.some(l=>l.toLowerCase().includes("po template")))return"procurementForecast";if(n.includes("week")||n.includes("sales")||s.some(l=>l.toLowerCase().includes("order"))){const l=a[s[0]]||[];if(l.length>0&&Object.keys(l[0]).map(c=>c.toLowerCase()).some(c=>c.includes("article")||c.includes("delivery")))return"salesOrder"}if(n.includes("inventory")||n.includes("balance"))return"inventoryBalance";if(n.includes("open")&&n.includes("po"))return"openPO";const o=a[s[0]]||[];if(o.length>0){const l=Object.keys(o[0]).map(d=>d.toLowerCase());if(l.some(d=>d.includes("qty_ordered")||d.includes("qty ordered"))&&l.some(d=>d.includes("product")))return"openPO";if(l.some(d=>d.includes("quantity available")||d.includes("stock")))return"inventoryBalance"}return null}function ls(a){const t=[];a.forEach(n=>{const o=String(n.Article||n.article||n.ARTICLE||"").trim(),l=n["Delivery Date"]||n.delivery_date||n.DeliveryDate||"",d=parseFloat(String(n["Still to be delivered (qty)"]??n.Qty??n.quantity??0)),c=parseFloat(String(n["Net Price"]??n.Price??0));o&&!isNaN(d)&&t.push({article:o,deliveryDate:String(l),stillToBeDeliveredQty:d,netPrice:c})});const s=new Map;return t.forEach(n=>{const o=s.get(n.article),l=pt(n.deliveryDate);o?(o.weeklyData[l]=(o.weeklyData[l]||0)+n.stillToBeDeliveredQty,o.grandTotal+=n.stillToBeDeliveredQty):s.set(n.article,{article:n.article,weeklyData:{[l]:n.stillToBeDeliveredQty},grandTotal:n.stillToBeDeliveredQty})}),{rows:t,pivot:Array.from(s.values())}}function is(a){const t=new Map,s=new Map;return a.forEach(n=>{const o=String(n.Product||n.Item||n["Item SAP No."]||n["Item SAP No"]||"").trim();if(!o)return;const l=parseFloat(String(n.Qty_Ordered??n["Qty Ordered"]??n.Qty??n.Quantity??0));if(isNaN(l))return;const d=n.ETA_Date??n["ETA Date"]??n.ETADate??n.ETA??"",c=pt(d),m=o.replace(/^0+(?=\d)/,"");new Set([o,o.toUpperCase(),m]).forEach(u=>{if(!u)return;const N=t.get(u)||0;t.set(u,N+l);const r=s.get(u)||{};r[c]=(r[c]||0)+l,s.set(u,r)})}),{totalMap:t,breakdownMap:s}}function cs(a){if(a instanceof Date&&!isNaN(a.getTime()))return a;const t=typeof a=="number"?a:Number(String(a??"").trim());if(!Number.isNaN(t)){if(t>=1e10)return new Date(t);if(t>0&&t<6e4){const d=Date.UTC(1899,11,30);return new Date(d+t*864e5)}}const s=String(a??"").trim();if(!s)return null;const n=/^(\d{1,2})[/-](\d{1,2})[/-](\d{2,4})$/.exec(s);if(n){const d=parseInt(n[1],10),c=parseInt(n[2],10)-1,m=parseInt(n[3],10);return new Date(m<100?2e3+m:m,c,d)}const o=/^(\d{4})[/-](\d{1,2})[/-](\d{1,2})$/.exec(s);if(o){const d=parseInt(o[1],10),c=parseInt(o[2],10)-1,m=parseInt(o[3],10);return new Date(d,c,m)}const l=new Date(s);return Number.isNaN(l.getTime())?null:l}function pt(a){const t=cs(a);if(!t)return"Unknown";const s=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear();return`${s}/${n}/${o}`}function ds(a){const t=new Map;return a.forEach(s=>{const n=String(s["Product Code"]||s.product_code||s.ProductCode||s["Item Code"]||s.SKU||s.Code||"").trim();if(!n)return;const o=n.replace(/^0+(?=\d)/,""),l=parseFloat(String(s["Quantity on Hand (Whole)"]??s["Quantity On Hand (Whole)"]??s["Quantity Available Now (Whole)"]??s["Qty Available"]??s["Available Qty"]??s.Stock??s.Quantity??0)),d=String(s.Description??s["Product Name"]??"").trim(),c=t.get(o);c?c.qty+=isNaN(l)?0:l:t.set(o,{qty:isNaN(l)?0:l,description:d})}),Array.from(t.entries()).map(([s,n])=>({productCode:s,quantityAvailableNow:n.qty,description:n.description}))}function us(a){return a.map(t=>{const s=String(t["Supplier Code"]||t.SupplierCode||"").trim(),n=String(t["Supplier Name"]||t.SupplierName||t["Supplier Full Name"]||t["Supplier FullName"]||t.Supplier||t["Vendor Name"]||"").trim()||s;return{supplierCode:s,vendorNo:String(t["Vendor No"]||t.VendorNo||"").trim(),supplierName:n,deliveryDay:String(t["Delivery Day"]||t.DeliveryDay||"").trim(),etaDate:String(t["ETA Date"]||t.ETADate||t.ETA||"").trim(),poNo:String(t.PO_No||t.PONo||t["PO No"]||"").trim(),fullPoNumber:String(t["Full PO Number"]||t.FullPONumber||"").trim(),warehouseLevel:String(t["Warehouse Level"]||t.WarehouseLevel||"").trim(),combinedKey:String(t["Combined Key"]||t.CombinedKey||"").trim()}}).filter(t=>t.supplierCode||t.supplierName)}function ps(a,t,s,n,o){const l=Object.keys(a[0]||{}),d=r=>r.toLowerCase().replace(/\s+/g," ").replace(/\s/g,"").replace(/[\n\r]+/g,""),c=new Map;l.forEach(r=>{c.set(d(r),r)});const m=r=>{const p=String(r??"").trim();return p?p.replace(/\s+/g,"").toUpperCase().replace(/^0+(?=\d)/,""):""},h=new Map,u=new Set;t.forEach(r=>{const p=String(r.productCode??"").trim();if(!p)return;const f=p.toUpperCase(),y=m(p);h.set(p,r.quantityAvailableNow),h.set(f,r.quantityAvailableNow),h.set(y,r.quantityAvailableNow),u.add(p),u.add(f),u.add(y)});const N=new Map;return s.forEach(r=>{const p=String(r.article??"").trim();if(!p)return;const f=p.toUpperCase(),y=m(p);N.set(p,r),N.set(f,r),N.set(y,r)}),a.map((r,p)=>{const f=String(r["Item SAP No."]||r["Item SAP No"]||r["SAP No"]||"").trim(),y=String(r["Product Code"]||r.Code||f).trim(),j=[f,y].filter(Boolean).flatMap(A=>[A,A.toUpperCase(),m(A)]).filter(Boolean),C=!!(f||y),b=j.map(A=>h.get(A)).find(A=>typeof A=="number"),O=C||j.some(A=>u.has(A)),k=j.map(A=>N.get(A)).find(Boolean),I=(k==null?void 0:k.grandTotal)??0,g=j.map(A=>n.get(A)).find(A=>typeof A=="number")??0,P=j.map(A=>o.get(A)).find(Boolean)||void 0,R=b??0,i=parseFloat(String(r[`Safety
Stock`]??r["Safety Stock"]??r.SafetyStock??0)),S=parseFloat(String(r.LPQ??r["Pack Size"]??r["Carton Size"]??1)),T=S>0?S:1,F=c.get(d("Unit Cost"))||c.get(d(`Unit
Cost`))||c.get(d("UnitCost"))||c.get(d("Unit Cost (SGD)"))||c.get(d("Unit Cost SGD"))||c.get(d("Unit Cost (SGD$)"))||"",z=(F?r[F]:void 0)??(l[4]?r[l[4]]:""),H=parseFloat(String(z||"0").replace(/[$,]/g,"")),M=Number.isFinite(H)?H:0,B=c.get(d("Description"))||c.get(d("Product Description"))||c.get(d("Item Description"))||"",_=(B?r[B]:void 0)??(l[8]?r[l[8]]:""),Q=R+g-I;let U=0,W=0;if((O||C)&&Q<i){const A=i-Q;W=A,U=Math.ceil(A/T)*T,U>0&&U<T&&(U=T)}const ce=String(r[`Storage
Type`]||r["Storage Type"]||r.StorageType||r[`Warehouse
Level`]||r["Warehouse Level"]||r.WarehouseLevel||"").trim();let ee="ok";(O||C)&&(Q<=0&&i>0?ee="critical":Q<i&&(ee="low"));const de=String(r["Supplier Code"]||r.Supplier||"").trim();return{id:`forecast-${p}`,itemSapNo:f,productCode:y,description:String(_||r.Description||r["Product Name"]||r["Item Description"]||"").trim(),supplier:String(r.Supplier||r["Supplier Name"]||"").trim(),supplierCode:de,warehouseLevel:ce,uom:String(r.UOM||r.Unit||"").trim(),sellingUom:String(r[`Selling
UOM`]||r["Selling UOM"]||r.SellingUOM||r.UOM||"").trim(),invBal:R,openPoQty:g,openPoBreakdown:P,sOrderQty:I,balanceQty:Q,safetyStock:i,reOrderQty:W,finalReorderQty:U,unitCost:M,hasInventoryRecord:O,alertStatus:ee,weeklyBreakdown:(k==null?void 0:k.weeklyData)||{},originalData:r}}).filter(r=>r.productCode||r.itemSapNo)}function ms(a){const t=m=>m.toLowerCase().replace(/[\s_-]+/g,""),s={whsCode:"whs_code",owner:"Owner",poNo:"PO_No",poDate:"PO Date",etaDate:"ETA Date",transCode:"Trans_code",supplierCode:"Supplier Code",supplierName:"Supplier Name",product:"Product",qtyOrdered:"Qty Ordered",origUomCode:"orig_uom_code"},n=Object.keys(a[0]||{}),o=(m,h)=>{const u=new Set(m.map(t));return n.find(r=>u.has(t(r)))||h},l={whsCode:o(["whs_code","WHS_CODE","WHS Code","whs code","Whs Code","whsCode"],s.whsCode),owner:o(["Owner","owner"],s.owner),poNo:o(["PO_No","PO No","PONo","PO Number"],s.poNo),poDate:o(["PO Date","PODate","PO date"],s.poDate),etaDate:o(["ETA Date","ETADate","ETA"],s.etaDate),transCode:o(["Trans_code","Trans Code","TransCode"],s.transCode),supplierCode:o(["Supplier Code","SupplierCode"],s.supplierCode),supplierName:o(["Supplier Name","SupplierName","Supplier"],s.supplierName),product:o(["Product","Item SAP No.","Item SAP No","SAP No"],s.product),qtyOrdered:o(["Qty Ordered","Qty","Quantity"],s.qtyOrdered),origUomCode:o(["orig_uom_code","Orig UOM Code","Orig UOM","UOM"],s.origUomCode)},d=(m,h,u)=>{const N=m[h]??u.map(r=>m[r]).find(r=>r!==void 0);return String(N??"").trim()};return{rows:a.map(m=>{const h=parseFloat(String(m[l.qtyOrdered]??m["Qty Ordered"]??m.Qty??m.Quantity??0));return{whsCode:d(m,l.whsCode,["whs_code","WHS_CODE","WHS Code","whs code","Whs Code","whsCode"]),owner:d(m,l.owner,["Owner","owner"]),poNo:d(m,l.poNo,["PO_No","PO No","PONo","PO Number"]),poDate:d(m,l.poDate,["PO Date","PODate","PO date"]),etaDate:d(m,l.etaDate,["ETA Date","ETADate","ETA"]),transCode:d(m,l.transCode,["Trans_code","Trans Code","TransCode"]),supplierCode:d(m,l.supplierCode,["Supplier Code","SupplierCode"]),supplierName:d(m,l.supplierName,["Supplier Name","SupplierName","Supplier"]),product:d(m,l.product,["Product","Item SAP No.","Item SAP No","SAP No"]),qtyOrdered:isNaN(h)?0:h,origUomCode:d(m,l.origUomCode,["orig_uom_code","Orig UOM Code","Orig UOM","UOM"])}}).filter(m=>m.product||m.supplierCode||m.poNo),headerMap:l}}function ea(a,t){const s=l=>String(l??"").trim(),n=new Map;t.forEach(l=>{const d=s(l.supplierCode);d&&(n.set(d,l),n.set(d.toUpperCase(),l))});const o=new Date().toISOString().split("T")[0];return a.filter(l=>l.finalReorderQty>0).map(l=>{const d=s(l.supplierCode),c=n.get(d)||n.get(d.toUpperCase()),m=String((c==null?void 0:c.supplierName)||"").trim(),h=String((c==null?void 0:c.supplierCode)||"").trim(),u=String(l.supplier||"").trim(),N=m&&m!==h?m:u||m;return{whsCode:"8JB",owner:"CPS",poNo:(c==null?void 0:c.poNo)||"",poDate:o,etaDate:(c==null?void 0:c.etaDate)||"",transCode:"GI",supplierCode:l.supplierCode,supplierName:N,product:l.itemSapNo,qtyOrdered:l.finalReorderQty,origUomCode:l.sellingUom}})}function xs(a){const t=a.filter(h=>h.hasInventoryRecord),s=t.filter(h=>h.alertStatus==="critical"),n=t.filter(h=>h.alertStatus==="low"),o=t.filter(h=>h.finalReorderQty>0),l=Math.ceil(o.reduce((h,u)=>{const N=Number.isFinite(u.unitCost)?u.unitCost:0;return h+u.finalReorderQty*N},0)),d=new Set(o.map(h=>h.supplier||h.supplierCode).filter(Boolean)).size,c=t.filter(h=>h.safetyStock>0),m=c.length>0?c.reduce((h,u)=>{const N=u.safetyStock/14;return h+(N>0?u.invBal/N:0)},0)/c.length:t.reduce((h,u)=>h+(u.sOrderQty>0?u.invBal/u.sOrderQty:0),0)/Math.max(1,t.length)*7;return{totalOrderValue:l,itemsBelowSafetyStock:s.length+n.length,avgStockCoverageDays:Math.round(m),ordersBySupplierCount:d,criticalItemsCount:s.length}}function fs(a,t){const s=a.filter(r=>r.hasInventoryRecord),n=new Map;t.forEach(r=>{Object.entries(r.weeklyData).forEach(([p,f])=>{n.set(p,(n.get(p)||0)+f)})});const o=Array.from(n.entries()).map(([r,p])=>({week:r,demand:p})).sort((r,p)=>r.week.localeCompare(p.week)).slice(0,4),l=[...s].filter(r=>r.finalReorderQty>0).sort((r,p)=>{const f=Number.isFinite(r.unitCost)?r.unitCost:0,y=Number.isFinite(p.unitCost)?p.unitCost:0;return p.finalReorderQty*y-r.finalReorderQty*f}).slice(0,10).map(r=>{const p=Number.isFinite(r.unitCost)?r.unitCost:0;return{product:r.description||r.productCode,value:Math.ceil(r.finalReorderQty*p)}}),d=new Map;s.forEach(r=>{const p=r.supplier||r.supplierCode||"Unknown",f=d.get(p)||{volume:0,cost:0};f.volume+=r.finalReorderQty;const y=Number.isFinite(r.unitCost)?r.unitCost:0;f.cost+=r.finalReorderQty*y,d.set(p,f)});const c=Array.from(d.entries()).map(([r,p])=>({supplier:r,volume:p.volume,cost:Math.ceil(p.cost)})).sort((r,p)=>p.volume-r.volume).slice(0,10),m={critical:0,low:0,ok:0};s.forEach(r=>m[r.alertStatus]++);const h=[{status:"Critical",count:m.critical},{status:"Low",count:m.low},{status:"Healthy",count:m.ok}],u=new Map;s.forEach(r=>{const p=r.warehouseLevel||"Unknown";u.set(p,(u.get(p)||0)+1)});const N=Array.from(u.entries()).map(([r,p])=>({level:r,count:p}));return{weeklyDemandTrend:o,topProductsByValue:l,supplierBreakdown:c,stockStatusDistribution:h,warehouseLevelDistribution:N}}function ta(a,t,s){const n=Date.UTC(1899,11,30),o=u=>{const N=u.trim();if(!N)return null;const r=Number(N);if(!Number.isNaN(r)){if(r>=1e10)return new Date(r);if(r>0&&r<6e4)return new Date(n+r*864e5)}const p=/^(\d{1,2})[/-](\d{1,2})[/-](\d{2,4})$/.exec(N);if(p){const j=parseInt(p[1],10),C=parseInt(p[2],10)-1,b=parseInt(p[3],10);return new Date(b<100?2e3+b:b,C,j)}const f=/^(\d{4})[/-](\d{1,2})[/-](\d{1,2})$/.exec(N);if(f){const j=parseInt(f[1],10),C=parseInt(f[2],10)-1,b=parseInt(f[3],10);return new Date(j,C,b)}const y=new Date(N);return Number.isNaN(y.getTime())?null:y},l=u=>(Date.UTC(u.getFullYear(),u.getMonth(),u.getDate())-n)/864e5,d=(u,N)=>{const r=u["!ref"]?K.decode_range(u["!ref"]):null;if(!r)return;let p=null;for(let f=r.s.c;f<=r.e.c;f+=1){const y=u[K.encode_cell({r:r.s.r,c:f})];if(String((y==null?void 0:y.v)??"").trim()===N){p=f;break}}if(p!==null)for(let f=r.s.r+1;f<=r.e.r;f+=1){const y=K.encode_cell({r:f,c:p}),j=u[y],C=o(String((j==null?void 0:j.v)??""));C&&(u[y]={t:"n",v:l(C),z:"dd/mm/yyyy"})}},c=s||{whsCode:"whs_code",owner:"Owner",poNo:"PO_No",poDate:"PO Date",etaDate:"ETA Date",transCode:"Trans_code",supplierCode:"Supplier Code",supplierName:"Supplier Name",product:"Product",qtyOrdered:"Qty Ordered",origUomCode:"orig_uom_code"},m=K.json_to_sheet(a.map(u=>({[c.whsCode]:u.whsCode,[c.owner]:u.owner,[c.poNo]:u.poNo,[c.poDate]:u.poDate,[c.etaDate]:u.etaDate,[c.transCode]:u.transCode,[c.supplierCode]:u.supplierCode,[c.supplierName]:u.supplierName,[c.product]:u.product,[c.qtyOrdered]:u.qtyOrdered,[c.origUomCode]:u.origUomCode})));d(m,c.etaDate);const h=K.book_new();K.book_append_sheet(h,m,"PO Template"),Zt(h,t)}const hs=[{type:"salesOrder",label:"Weekly Sales Order",description:"e.g., 17_Dec_Week_52_ver_1.xlsx"},{type:"inventoryBalance",label:"Inventory Balance Report",description:"e.g., Inventory_Balance_By_Product_Report.xlsx"},{type:"openPO",label:"Open PO Report",description:"Pivot Qty_Ordered by Product (incoming PO)"},{type:"procurementForecast",label:"Procurement Forecast Master",description:"Contains: Proc. Forecast, Supplier Code tabs"}];function gs({onFilesUploaded:a,uploadedFiles:t}){const[s,n]=x.useState(!1),[o,l]=x.useState(!1),[d,c]=x.useState(null),m=x.useCallback(async p=>{l(!0);const f=[...t];for(const y of p)try{const{sheets:j,arrayBuffer:C}=await ns(y);let b=os(j,y.name);if(!b){const k=y.name.toLowerCase(),I=k.includes("inventory")||k.includes("balance"),g=k.includes("sales")||k.includes("order");!I&&!g&&(k.includes("forecast")||k.includes("proc"))&&(b="procurementForecast")}if(!b){c(`Could not determine file type for: ${y.name}. Please ensure it is a valid template.`);continue}const O=f.findIndex(k=>k.type===b);O>=0&&((b==="inventoryBalance"||b==="salesOrder"||b==="openPO")&&f.splice(O,1),b==="procurementForecast"&&f.splice(O,1)),f.push({name:y.name,type:b,data:j,rawFile:y,arrayBuffer:C,uploadedAt:new Date})}catch(j){c(`Error processing ${y.name}: ${j instanceof Error?j.message:"Unknown error"}`)}l(!1),a(f)},[a,t]),h=x.useCallback(async p=>{p.preventDefault(),n(!1),c(null);const f=Array.from(p.dataTransfer.files).filter(y=>y.name.endsWith(".xlsx")||y.name.endsWith(".xls")||y.name.endsWith(".xlsm")||y.name.endsWith(".xlsb"));if(f.length===0){c("Please upload Excel files (.xlsx, .xls, .xlsm, .xlsb)");return}await m(f)},[m]),u=async p=>{const f=Array.from(p.target.files||[]);f.length>0&&(c(null),await m(f))},N=p=>{a(t.filter(f=>f.type!==p))},r=p=>t.find(f=>f.type===p);return e.jsxs(ae,{className:"border-2 border-dashed border-border bg-card/50",children:[e.jsx(re,{children:e.jsxs(ne,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Pt,{className:"h-5 w-5 text-primary"}),"Upload Files"]})}),e.jsxs(oe,{className:"space-y-4",children:[e.jsx("div",{onDragOver:p=>{p.preventDefault(),n(!0)},onDragLeave:()=>n(!1),onDrop:h,className:v("relative rounded-lg border-2 border-dashed p-8 text-center transition-all duration-200",s?"border-primary bg-primary/5 scale-[1.02]":"border-muted-foreground/25 hover:border-primary/50 hover:bg-muted/50"),children:o?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(Mt,{className:"h-10 w-10 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Processing files..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"mx-auto h-12 w-12 text-muted-foreground/50"}),e.jsx("p",{className:"mt-2 text-sm font-medium",children:"Drag & drop Excel files here"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"or click to browse"}),e.jsx("input",{type:"file",multiple:!0,accept:".xlsx,.xls,.xlsm,.xlsb",onChange:u,className:"absolute inset-0 cursor-pointer opacity-0"})]})}),d&&e.jsx("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:d}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Required Files:"}),hs.map(p=>{const f=r(p.type);return e.jsxs("div",{className:v("flex items-center justify-between rounded-lg border p-3 transition-colors",f?"border-success/50 bg-success/5":"border-border"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[f?e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-success/20",children:e.jsx(Pe,{className:"h-4 w-4 text-success"})}):e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-muted",children:e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:p.label}),f?e.jsx("p",{className:"text-xs text-success",children:f.name}):e.jsx("p",{className:"text-xs text-muted-foreground",children:p.description})]})]}),f&&e.jsx($,{variant:"ghost",size:"sm",onClick:()=>N(p.type),className:"h-8 w-8 p-0 hover:bg-destructive/10 hover:text-destructive",children:e.jsx(Lt,{className:"h-4 w-4"})})]},p.type)})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(q,{variant:t.length===4?"default":"secondary",children:[t.length,"/4 files uploaded"]})}),t.length===4&&e.jsx("p",{className:"text-sm text-success font-medium",children:"Ready to process!"})]})]})]})}function ys({kpis:a}){const t=[{label:"Total Order Value",value:`$${a.totalOrderValue.toLocaleString()}`,icon:Tt,color:"var(--aurora-cyan)",sparkline:[12,16,14,18,22,26,24,30]},{label:"Items Below Safety Stock",value:a.itemsBelowSafetyStock,icon:we,color:"var(--aurora-amber)",sparkline:[8,10,14,12,15,19,16,20]},{label:"Avg Stock Coverage",value:`${a.avgStockCoverageDays} days`,icon:At,color:"var(--aurora-blue)",sparkline:[10,11,13,12,13,14,13,15]},{label:"Suppliers to Order",value:a.ordersBySupplierCount,icon:It,color:"var(--aurora-mint)",sparkline:[6,9,8,11,10,12,11,13]},{label:"Critical Items",value:a.criticalItemsCount,icon:Rt,color:"var(--aurora-red)",sparkline:[4,6,7,9,8,11,10,12]}];return e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-3 lg:grid-cols-5",children:t.map(s=>e.jsxs("div",{className:"kpi-card",style:{"--kpi-glow":s.color},children:[e.jsxs("div",{className:"kpi-card__top",children:[e.jsxs("div",{className:"kpi-card__meta",children:[e.jsx("p",{className:"kpi-card__label",children:s.label}),e.jsx("p",{className:"kpi-card__value",children:s.value})]}),e.jsx("div",{className:"kpi-orb",children:e.jsx(s.icon,{className:"kpi-orb__icon"})})]}),e.jsx("div",{className:"kpi-card__sparkline",children:e.jsxs("svg",{viewBox:"0 0 120 36","aria-hidden":"true",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`spark-${s.label}`,x1:"0",x2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:s.color,stopOpacity:"0.2"}),e.jsx("stop",{offset:"100%",stopColor:s.color,stopOpacity:"0.9"})]})}),e.jsx("polyline",{fill:"none",stroke:`url(#spark-${s.label})`,strokeWidth:"2.5",points:s.sparkline.map((n,o)=>`${o*15},${36-n}`).join(" ")})]})}),e.jsx("div",{className:"kpi-card__glow"}),e.jsx("div",{className:"kpi-card__sweep"})]},s.label))})}const he=x.forwardRef(({className:a,...t},s)=>e.jsx("div",{className:"w-full overflow-auto",children:e.jsx("table",{ref:s,className:v("w-full caption-bottom text-sm",a),...t})}));he.displayName="Table";const ge=x.forwardRef(({className:a,...t},s)=>e.jsx("thead",{ref:s,className:v("[&_tr]:border-b",a),...t}));ge.displayName="TableHeader";const ye=x.forwardRef(({className:a,...t},s)=>e.jsx("tbody",{ref:s,className:v("[&_tr:last-child]:border-0",a),...t}));ye.displayName="TableBody";const Ns=x.forwardRef(({className:a,...t},s)=>e.jsx("tfoot",{ref:s,className:v("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...t}));Ns.displayName="TableFooter";const E=x.forwardRef(({className:a,...t},s)=>e.jsx("tr",{ref:s,className:v("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...t}));E.displayName="TableRow";const L=x.forwardRef(({className:a,...t},s)=>e.jsx("th",{ref:s,className:v("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...t}));L.displayName="TableHead";const D=x.forwardRef(({className:a,...t},s)=>e.jsx("td",{ref:s,className:v("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...t}));D.displayName="TableCell";const js=x.forwardRef(({className:a,...t},s)=>e.jsx("caption",{ref:s,className:v("mt-4 text-sm text-muted-foreground",a),...t}));js.displayName="TableCaption";const me=Ht,xe=Kt,le=x.forwardRef(({className:a,children:t,...s},n)=>e.jsxs(We,{ref:n,className:v("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...s,children:[t,e.jsx(Ut,{asChild:!0,children:e.jsx(X,{className:"h-4 w-4 opacity-50"})})]}));le.displayName=We.displayName;const ie=x.forwardRef(({className:a,children:t,position:s="popper",...n},o)=>e.jsx(Vt,{children:e.jsxs(Ge,{ref:o,className:v("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:s,...n,children:[e.jsx(mt,{}),e.jsx($t,{className:v("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(xt,{})]})}));ie.displayName=Ge.displayName;const bs=x.forwardRef(({className:a,...t},s)=>e.jsx(Ye,{ref:s,className:v("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...t}));bs.displayName=Ye.displayName;const V=x.forwardRef(({className:a,children:t,...s},n)=>e.jsxs(Je,{ref:n,className:v("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(zt,{children:e.jsx(Pe,{className:"h-4 w-4"})})}),e.jsx(qt,{children:t})]}));V.displayName=Je.displayName;const vs=x.forwardRef(({className:a,...t},s)=>e.jsx(Xe,{ref:s,className:v("-mx-1 my-1 h-px bg-muted",a),...t}));vs.displayName=Xe.displayName;const mt=x.forwardRef(({className:a,...t},s)=>e.jsx(Ze,{ref:s,className:v("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(fe,{className:"h-4 w-4"})}));mt.displayName=Ze.displayName;const xt=x.forwardRef(({className:a,...t},s)=>e.jsx(et,{ref:s,className:v("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(X,{className:"h-4 w-4"})}));xt.displayName=et.displayName;const Ss=Gt,Cs=Yt,ks=x.forwardRef(({className:a,inset:t,children:s,...n},o)=>e.jsxs(tt,{ref:o,className:v("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",a),...n,children:[s,e.jsx(ze,{className:"ml-auto h-4 w-4"})]}));ks.displayName=tt.displayName;const ws=x.forwardRef(({className:a,...t},s)=>e.jsx(st,{ref:s,className:v("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t}));ws.displayName=st.displayName;const ft=x.forwardRef(({className:a,sideOffset:t=4,...s},n)=>e.jsx(Wt,{children:e.jsx(at,{ref:n,sideOffset:t,className:v("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s})}));ft.displayName=at.displayName;const Ds=x.forwardRef(({className:a,inset:t,...s},n)=>e.jsx(rt,{ref:n,className:v("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",a),...s}));Ds.displayName=rt.displayName;const De=x.forwardRef(({className:a,children:t,checked:s,...n},o)=>e.jsxs(nt,{ref:o,className:v("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:s,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ot,{children:e.jsx(Pe,{className:"h-4 w-4"})})}),t]}));De.displayName=nt.displayName;const Os=x.forwardRef(({className:a,children:t,...s},n)=>e.jsxs(lt,{ref:n,className:v("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ot,{children:e.jsx(Bt,{className:"h-2 w-2 fill-current"})})}),t]}));Os.displayName=lt.displayName;const Ps=x.forwardRef(({className:a,inset:t,...s},n)=>e.jsx(it,{ref:n,className:v("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",a),...s}));Ps.displayName=it.displayName;const Ms=x.forwardRef(({className:a,...t},s)=>e.jsx(ct,{ref:s,className:v("-mx-1 my-1 h-px bg-muted",a),...t}));Ms.displayName=ct.displayName;function Ls({data:a,filters:t,onFiltersChange:s}){const[n,o]=x.useState(new Set),[l,d]=x.useState("product"),[c,m]=x.useState("asc"),h=[...new Set(a.map(i=>i.supplier||i.supplierCode).filter(Boolean))],u=[...new Set(a.map(i=>i.warehouseLevel).filter(Boolean))],N=[{value:"critical",label:"Critical"},{value:"low",label:"Low"},{value:"ok",label:"OK"}],r=N.map(i=>i.value),p=t.alertStatus||[],f=p.length===0||p.length===r.length,y=i=>{const S=(i==null?void 0:i.trim())||"";return S.length>30?`${S.slice(0,30)}…`:S},j=i=>{const S=Array.from(new Set(i)).filter(T=>r.includes(T));s({...t,alertStatus:S.length===r.length?[]:S})},C=(i,S)=>{const T=f?r:p,F=S?[...T,i]:T.filter(z=>z!==i);j(F)},b=i=>{l===i?m(c==="asc"?"desc":"asc"):(d(i),m("asc"))},O=(i,S)=>{switch(S){case"product":return i.productCode||i.itemSapNo;case"supplier":return i.supplier||i.supplierCode;case"invBal":return i.invBal;case"openPoQty":return i.openPoQty;case"sOrderQty":return i.sOrderQty;case"safetyStock":return i.safetyStock;case"balanceQty":return i.balanceQty;case"reorderQty":return i.finalReorderQty;case"status":return i.alertStatus;default:return""}},k=i=>l!==i?e.jsx(Le,{className:"h-3.5 w-3.5 text-muted-foreground"}):c==="asc"?e.jsx(fe,{className:"h-3.5 w-3.5 text-muted-foreground"}):e.jsx(X,{className:"h-3.5 w-3.5 text-muted-foreground"}),I=a.filter(i=>{if(t.searchQuery){const S=t.searchQuery.toLowerCase();if(!i.productCode.toLowerCase().includes(S)&&!i.description.toLowerCase().includes(S)&&!i.supplier.toLowerCase().includes(S))return!1}return!(t.supplier&&t.supplier!=="all"&&i.supplier!==t.supplier&&i.supplierCode!==t.supplier||t.warehouseLevel&&t.warehouseLevel!=="all"&&i.warehouseLevel!==t.warehouseLevel||!f&&!p.includes(i.alertStatus))}),g=[...I].sort((i,S)=>{const T=O(i,l),F=O(S,l);if(typeof T=="number"&&typeof F=="number")return c==="asc"?T-F:F-T;const z=String(T??"").toLowerCase(),H=String(F??"").toLowerCase();return c==="asc"?z.localeCompare(H):H.localeCompare(z)}),P=i=>{const S=new Set(n);S.has(i)?S.delete(i):S.add(i),o(S)},R=i=>{switch(i){case"critical":return e.jsx(q,{variant:"destructive",children:"Critical"});case"low":return e.jsx(q,{className:"bg-warning text-warning-foreground",children:"Low"});default:return e.jsx(q,{className:"bg-success text-success-foreground",children:"OK"})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(Me,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Z,{placeholder:"Search products, suppliers...",value:t.searchQuery,onChange:i=>s({...t,searchQuery:i.target.value}),className:"pl-9"})]}),e.jsxs(me,{value:t.supplier||"all",onValueChange:i=>s({...t,supplier:i}),children:[e.jsx(le,{className:"w-[180px]",children:e.jsx(xe,{placeholder:"All Suppliers"})}),e.jsxs(ie,{children:[e.jsx(V,{value:"all",children:"All Suppliers"}),h.map(i=>e.jsx(V,{value:i,children:i},i))]})]}),e.jsxs(me,{value:t.warehouseLevel||"all",onValueChange:i=>s({...t,warehouseLevel:i}),children:[e.jsx(le,{className:"w-[180px]",children:e.jsx(xe,{placeholder:"All Storage Types"})}),e.jsxs(ie,{children:[e.jsx(V,{value:"all",children:"All Storage Types"}),u.map(i=>e.jsx(V,{value:i,children:i},i))]})]}),e.jsxs(Ss,{children:[e.jsx(Cs,{asChild:!0,children:e.jsxs($,{variant:"outline",className:"w-[150px] justify-between",children:[f?"All Status":`${p.length} Status`,e.jsx(_t,{className:"h-4 w-4 text-muted-foreground"})]})}),e.jsxs(ft,{align:"end",className:"w-[180px]",children:[e.jsx(De,{checked:f,onCheckedChange:()=>j([]),children:"All Status"}),N.map(i=>e.jsx(De,{checked:f||p.includes(i.value),onCheckedChange:S=>C(i.value,!!S),children:i.label},i.value))]})]}),e.jsxs(q,{variant:"outline",className:"ml-auto",children:[I.length," items"]})]}),e.jsx("div",{className:"soft-panel rounded-2xl border bg-card overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(he,{children:[e.jsx(ge,{children:e.jsxs(E,{className:"bg-muted/60",children:[e.jsx(L,{className:"w-[40px]"}),e.jsx(L,{children:e.jsxs("button",{className:"flex items-center gap-2",onClick:()=>b("product"),type:"button",children:["Product ",k("product")]})}),e.jsx(L,{children:e.jsxs("button",{className:"flex items-center gap-2",onClick:()=>b("supplier"),type:"button",children:["Supplier ",k("supplier")]})}),e.jsx(L,{className:"text-left",children:e.jsx("span",{className:"text-muted-foreground",children:"UOM"})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>b("invBal"),type:"button",children:["Inv Bal ",k("invBal")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>b("openPoQty"),type:"button",children:["Open PO ",k("openPoQty")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>b("sOrderQty"),type:"button",children:["S.Order Qty ",k("sOrderQty")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>b("safetyStock"),type:"button",children:["Safety Stock ",k("safetyStock")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>b("balanceQty"),type:"button",children:["Balance ",k("balanceQty")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>b("reorderQty"),type:"button",children:["Reorder Qty ",k("reorderQty")]})}),e.jsx(L,{children:e.jsxs("button",{className:"flex items-center gap-2",onClick:()=>b("status"),type:"button",children:["Status ",k("status")]})})]})}),e.jsxs(ye,{children:[g.map(i=>e.jsxs(e.Fragment,{children:[e.jsxs(E,{className:v("transition-colors",i.alertStatus==="critical"&&"bg-destructive/5"),children:[e.jsx(D,{children:i.weeklyBreakdown&&Object.keys(i.weeklyBreakdown).length>0&&e.jsx($,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>P(i.id),children:n.has(i.id)?e.jsx(X,{className:"h-4 w-4"}):e.jsx(ze,{className:"h-4 w-4"})})}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:i.productCode}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y(i.description)})]})}),e.jsx(D,{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:i.supplier||i.supplierCode}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i.warehouseLevel})]})}),e.jsx(D,{className:"text-sm",children:i.uom||i.sellingUom||"—"}),e.jsx(D,{className:"text-right font-mono",children:i.invBal.toLocaleString()}),e.jsx(D,{className:"text-right font-mono",children:i.openPoQty.toLocaleString()}),e.jsx(D,{className:"text-right font-mono",children:i.sOrderQty.toLocaleString()}),e.jsx(D,{className:"text-right font-mono",children:i.safetyStock.toLocaleString()}),e.jsx(D,{className:v("text-right font-mono",i.balanceQty<0&&"text-destructive"),children:i.balanceQty.toLocaleString()}),e.jsx(D,{className:"text-right font-mono font-medium",children:i.finalReorderQty>0?i.finalReorderQty.toLocaleString():"-"}),e.jsx(D,{children:R(i.alertStatus)})]},i.id),n.has(i.id)&&i.weeklyBreakdown&&e.jsx(E,{className:"bg-muted/30",children:e.jsx(D,{colSpan:11,className:"py-2",children:e.jsxs("div",{className:"pl-12 flex flex-wrap gap-3",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Outbound Orders:"}),Object.entries(i.weeklyBreakdown).map(([S,T])=>e.jsxs(q,{variant:"outline",className:"text-xs",children:[S,": ",T.toLocaleString()]},S))]})})}),n.has(i.id)&&i.openPoBreakdown&&e.jsx(E,{className:"bg-muted/30",children:e.jsx(D,{colSpan:11,className:"py-2",children:e.jsxs("div",{className:"pl-12 flex flex-wrap gap-3",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Open PO (ETA):"}),Object.entries(i.openPoBreakdown).map(([S,T])=>e.jsxs(q,{variant:"outline",className:"text-xs",children:[S,": ",T.toLocaleString()]},S))]})})})]})),I.length===0&&e.jsx(E,{children:e.jsx(D,{colSpan:10,className:"h-32 text-center text-muted-foreground",children:"No items found matching your filters."})})]})]})})})]})}function Ts({data:a}){const[t,s]=x.useState(""),[n,o]=x.useState("totalCost"),[l,d]=x.useState("desc"),c=x.useMemo(()=>{let r=0,p=0,f="",y=0;return a.forEach(j=>{const C=j.invBal||0,b=j.unitCost||0,O=C*b;r+=O,O>p&&(p=O,f=j.productCode||j.itemSapNo),j.safetyStock>0&&C>j.safetyStock&&(y+=(C-j.safetyStock)*b)}),{totalValue:r,maxProductValue:p,maxValueProduct:f,overstockValue:y}},[a]),m=r=>`$${Math.ceil(r).toLocaleString()}`,h=x.useMemo(()=>[...a.map(y=>{const j=y.invBal||0,C=y.unitCost||0,b=y.safetyStock||0,O=Math.max(0,j-b),k=j*C,I=O*C;return{product:y.productCode||y.itemSapNo,description:y.description||"—",qty:j,safetyStock:b,overstockQty:O,unitCost:C,totalCost:k,overstockValue:I}}).filter(y=>{if(!t)return!0;const j=t.toLowerCase();return y.product.toLowerCase().includes(j)||y.description.toLowerCase().includes(j)})].sort((y,j)=>{const C=y[n],b=j[n];if(typeof C=="number"&&typeof b=="number")return l==="asc"?C-b:b-C;const O=String(C??"").toLowerCase(),k=String(b??"").toLowerCase();return l==="asc"?O.localeCompare(k):k.localeCompare(O)}),[a,t,n,l]),u=r=>{n===r?d(l==="asc"?"desc":"asc"):(o(r),d("asc"))},N=r=>n!==r?e.jsx(Le,{className:"h-3.5 w-3.5 text-muted-foreground"}):l==="asc"?e.jsx(fe,{className:"h-3.5 w-3.5 text-muted-foreground"}):e.jsx(X,{className:"h-3.5 w-3.5 text-muted-foreground"});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(Z,{placeholder:"Search product code or description...",value:t,onChange:r=>s(r.target.value),className:"max-w-sm"})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(ae,{className:"soft-panel rounded-2xl border bg-card",children:[e.jsx(re,{className:"pb-2",children:e.jsx(ne,{className:"text-sm font-medium text-muted-foreground",children:"Inventory Holding Value"})}),e.jsx(oe,{children:e.jsx("div",{className:"text-3xl font-semibold",children:m(c.totalValue)})})]}),e.jsxs(ae,{className:"soft-panel rounded-2xl border bg-card",children:[e.jsx(re,{className:"pb-2",children:e.jsx(ne,{className:"text-sm font-medium text-muted-foreground",children:"Highest Product Value"})}),e.jsxs(oe,{children:[e.jsx("div",{className:"text-2xl font-semibold",children:m(c.maxProductValue)}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:c.maxValueProduct||"—"})]})]}),e.jsxs(ae,{className:v("soft-panel rounded-2xl border bg-card",c.overstockValue>0&&"kpi-card"),style:c.overstockValue>0?{"--kpi-glow":"var(--aurora-amber)"}:void 0,children:[e.jsx(re,{className:"pb-2",children:e.jsx(ne,{className:"text-sm font-medium text-muted-foreground",children:"Overstock Value"})}),e.jsxs(oe,{children:[e.jsx("div",{className:"text-2xl font-semibold",children:m(c.overstockValue)}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Inv Bal above safety stock"})]})]})]}),e.jsx("div",{className:"soft-panel rounded-2xl border bg-card overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(he,{children:[e.jsx(ge,{children:e.jsxs(E,{className:"bg-muted/60",children:[e.jsx(L,{children:e.jsxs("button",{className:"flex items-center gap-2",onClick:()=>u("product"),type:"button",children:["Product Code ",N("product")]})}),e.jsx(L,{children:e.jsxs("button",{className:"flex items-center gap-2",onClick:()=>u("description"),type:"button",children:["Description ",N("description")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>u("qty"),type:"button",children:["Qty on Hand ",N("qty")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>u("safetyStock"),type:"button",children:["Safety Stock ",N("safetyStock")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>u("overstockQty"),type:"button",children:["Overstock Qty ",N("overstockQty")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>u("unitCost"),type:"button",children:["Cost / Unit ",N("unitCost")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>u("totalCost"),type:"button",children:["Total Cost ",N("totalCost")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>u("overstockValue"),type:"button",children:["Overstock Value ",N("overstockValue")]})})]})}),e.jsxs(ye,{children:[h.map(r=>e.jsxs(E,{children:[e.jsx(D,{className:"font-medium",children:r.product}),e.jsx(D,{className:"text-sm text-muted-foreground",children:r.description}),e.jsx(D,{className:"text-right font-mono",children:r.qty.toLocaleString()}),e.jsx(D,{className:"text-right font-mono",children:r.safetyStock.toLocaleString()}),e.jsx(D,{className:v("text-right font-mono",r.overstockQty>0&&"text-warning font-semibold"),children:r.overstockQty.toLocaleString()}),e.jsxs(D,{className:"text-right font-mono",children:["$",r.unitCost.toFixed(2)]}),e.jsxs(D,{className:"text-right font-mono",children:["$",Math.ceil(r.totalCost).toLocaleString()]}),e.jsxs(D,{className:v("text-right font-mono",r.overstockValue>0&&"text-warning font-semibold"),children:["$",Math.ceil(r.overstockValue).toLocaleString()]})]},`${r.product}-${r.description}`)),h.length===0&&e.jsx(E,{children:e.jsx(D,{colSpan:8,className:"h-32 text-center text-muted-foreground",children:"No inventory data available."})})]})]})})})]})}function As({count:a=1200,radius:t=16,color:s="#7ae0ff",size:n=.05}){const o=x.useRef(null),l=x.useMemo(()=>{const d=new Float32Array(a*3);for(let c=0;c<a;c+=1){const m=Math.random()*t,h=Math.random()*Math.PI*2,u=Math.acos(2*Math.random()-1);d[c*3]=m*Math.sin(u)*Math.cos(h),d[c*3+1]=m*Math.cos(u)*.65,d[c*3+2]=m*Math.sin(u)*Math.sin(h)}return d},[a,t]);return Ve(d=>{const c=d.clock.getElapsedTime();o.current&&(o.current.rotation.y=c*.06,o.current.rotation.x=Math.sin(c*.15)*.1)}),e.jsxs("points",{ref:o,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",args:[l,3]})}),e.jsx("pointsMaterial",{color:s,size:n,transparent:!0,opacity:.5,depthWrite:!1})]})}function Is(){const a=x.useRef(null),t=x.useRef(null),{nodes:s,linePairs:n}=x.useMemo(()=>{const d=Array.from({length:70}).map(()=>new pe(-3+(Math.random()-.5)*4,(Math.random()-.5)*4,(Math.random()-.5)*4)),c=Array.from({length:70}).map(()=>new pe(3+(Math.random()-.5)*4,(Math.random()-.5)*4,(Math.random()-.5)*4)),m=Array.from({length:20}).map(()=>new pe((Math.random()-.5)*2,(Math.random()-.5)*2,(Math.random()-.5)*2)),h=[...d,...c,...m].map(N=>({position:N,phase:Math.random()*Math.PI*2,drift:new pe((Math.random()-.5)*.2,(Math.random()-.5)*.2,(Math.random()-.5)*.2)})),u=[];return h.forEach((N,r)=>{h.map((f,y)=>({oIdx:y,dist:N.position.distanceTo(f.position)})).filter(f=>f.oIdx!==r).sort((f,y)=>f.dist-y.dist).slice(0,3).forEach(f=>{f.oIdx>r&&u.push([r,f.oIdx])})}),{nodes:h,linePairs:u}},[]),o=x.useMemo(()=>new Float32Array(s.length*3),[s.length]),l=x.useMemo(()=>new Float32Array(n.length*6),[n.length]);return Ve(d=>{const c=d.clock.getElapsedTime();s.forEach((m,h)=>{const u=Math.sin(c*.8+m.phase)*.15,N=m.position.x+m.drift.x*u,r=m.position.y+m.drift.y*u,p=m.position.z+m.drift.z*u;o[h*3]=N,o[h*3+1]=r,o[h*3+2]=p}),n.forEach((m,h)=>{const[u,N]=m;l[h*6]=o[u*3],l[h*6+1]=o[u*3+1],l[h*6+2]=o[u*3+2],l[h*6+3]=o[N*3],l[h*6+4]=o[N*3+1],l[h*6+5]=o[N*3+2]}),a.current&&(a.current.geometry.attributes.position.needsUpdate=!0),t.current&&(t.current.geometry.attributes.position.needsUpdate=!0)}),e.jsxs("group",{position:[0,0,-2],children:[e.jsxs("points",{ref:a,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",args:[o,3]})}),e.jsx("pointsMaterial",{color:"#7aa2ff",size:.08,transparent:!0,opacity:.75})]}),e.jsxs("lineSegments",{ref:t,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",args:[l,3]})}),e.jsx("lineBasicMaterial",{color:"#00e5ff",transparent:!0,opacity:.25})]})]})}function Rs(){return e.jsxs("div",{className:"scene-3d",children:[e.jsxs(wt,{dpr:[1,2],camera:{position:[0,0,14],fov:45},gl:{alpha:!0,antialias:!0},children:[e.jsx("color",{attach:"background",args:["#0b1022"]}),e.jsx("fog",{attach:"fog",args:["#0b1022",10,30]}),e.jsx("ambientLight",{intensity:.75}),e.jsx("directionalLight",{position:[10,12,8],intensity:1.2,color:"#dfe9ff"}),e.jsx("pointLight",{position:[-8,-6,-6],intensity:.9,color:"#7aa2ff"}),e.jsx("pointLight",{position:[6,-8,4],intensity:.6,color:"#7effc7"}),e.jsx(As,{color:"#7aa2ff",size:.05}),e.jsx(Is,{}),e.jsxs("mesh",{position:[0,-7.2,-6],rotation:[-Math.PI/2,0,0],children:[e.jsx("planeGeometry",{args:[32,32,24,24]}),e.jsx("meshBasicMaterial",{color:"#6e8bff",transparent:!0,opacity:.08,wireframe:!0})]})]}),e.jsx("div",{className:"scene-veil"})]})}function Bs({meta:a}){const[t,s]=x.useState(Date.now());if(x.useEffect(()=>{const o=setInterval(()=>s(Date.now()),6e4);return()=>clearInterval(o)},[]),!a)return e.jsxs("div",{className:"audit-status",children:[e.jsx("span",{className:"audit-dot audit-dot--idle"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"No data loaded"})]});const n=Math.max(0,Math.round((t-a.createdAt)/6e4));return e.jsxs("div",{className:"audit-status",children:[e.jsx("span",{className:"audit-dot"}),e.jsxs("div",{className:"audit-text",children:[e.jsxs("span",{className:"audit-title",children:["Data loaded ",n," min ago"]}),e.jsxs("span",{className:"audit-meta",children:["Source: ",a.sourceFilename]}),e.jsxs("span",{className:"audit-meta",children:["Rows: ",a.rowCount]})]})]})}function _s({history:a}){return e.jsxs("div",{className:"soft-panel rounded-2xl border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground",children:"Upload History"}),e.jsxs("div",{className:"mt-3 space-y-2 text-xs",children:[a.length===0&&e.jsx("p",{className:"text-muted-foreground",children:"No uploads recorded."}),a.map(t=>e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium",children:t.label||t.sourceFilename}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:new Date(t.createdAt).toLocaleString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold",children:t.rowCount}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"rows"})]})]},t.id))]})]})}const Qs="compass-forecast-hub",Es=1;let Ce=null;function Ne(){return Ce||(Ce=Qt(Qs,Es,{upgrade(a){a.createObjectStore("datasets",{keyPath:"meta.id"}).createIndex("by-createdAt","meta.createdAt"),a.createObjectStore("uploads",{keyPath:"id"}).createIndex("by-createdAt","createdAt"),a.createObjectStore("snapshots",{keyPath:"id"}).createIndex("by-createdAt","createdAt")}})),Ce}async function Fs(a){const t=await Ne();await t.put("datasets",a),await t.put("uploads",a.meta)}async function Us(){const s=await(await Ne()).transaction("datasets").store.index("by-createdAt").openCursor(null,"prev");return(s==null?void 0:s.value)??null}async function Ue(a=10){const s=(await Ne()).transaction("uploads").store.index("by-createdAt"),n=[];let o=await s.openCursor(null,"prev");for(;o&&n.length<a;)n.push(o.value),o=await o.continue();return n}async function sa(a){await(await Ne()).put("snapshots",a)}const ht=x.forwardRef(({className:a,...t},s)=>e.jsx(dt,{ref:s,className:v("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...t,children:e.jsx(Jt,{className:v("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));ht.displayName=dt.displayName;function Vs({data:a}){const[t,s]=x.useState(""),[n,o]=x.useState("all"),[l,d]=x.useState("all"),[c,m]=x.useState(!1),[h,u]=x.useState("coverageDays"),[N,r]=x.useState("desc"),p=g=>{const P=(g==null?void 0:g.trim())||"";return P.length>20?`${P.slice(0,20)}…`:P},f=x.useMemo(()=>[...new Set(a.map(g=>g.supplier||g.supplierCode).filter(Boolean))],[a]),y=x.useMemo(()=>[...new Set(a.map(g=>g.warehouseLevel).filter(Boolean))],[a]),j=g=>{if(!g.safetyStock||g.safetyStock<=0)return null;const P=g.safetyStock/14;return P>0?g.invBal/P:null},C=(g,P)=>{switch(P){case"product":return g.productCode||g.itemSapNo;case"supplier":return g.supplier||g.supplierCode;case"invBal":return g.invBal;case"safetyStock":return g.safetyStock;case"coverageDays":return j(g)??-1;default:return""}},b=g=>{h===g?r(N==="asc"?"desc":"asc"):(u(g),r("asc"))},O=g=>h!==g?e.jsx(Le,{className:"h-3.5 w-3.5 text-muted-foreground"}):N==="asc"?e.jsx(fe,{className:"h-3.5 w-3.5 text-muted-foreground"}):e.jsx(X,{className:"h-3.5 w-3.5 text-muted-foreground"}),k=a.filter(g=>{if(t){const P=t.toLowerCase(),R=(g.productCode||g.itemSapNo||"").toLowerCase(),i=(g.description||"").toLowerCase(),S=(g.supplier||"").toLowerCase();if(!R.includes(P)&&!i.includes(P)&&!S.includes(P))return!1}if(n!=="all"&&g.supplier!==n&&g.supplierCode!==n||l!=="all"&&g.warehouseLevel!==l)return!1;if(c){const P=j(g);if(P===null||P<=14)return!1}return!0}),I=[...k].sort((g,P)=>{const R=C(g,h),i=C(P,h);if(typeof R=="number"&&typeof i=="number")return N==="asc"?R-i:i-R;const S=String(R??"").toLowerCase(),T=String(i??"").toLowerCase();return N==="asc"?S.localeCompare(T):T.localeCompare(S)});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[220px]",children:[e.jsx(Me,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Z,{placeholder:"Search product, description, supplier...",value:t,onChange:g=>s(g.target.value),className:"pl-9"})]}),e.jsxs(me,{value:n,onValueChange:o,children:[e.jsx(le,{className:"w-[180px]",children:e.jsx(xe,{placeholder:"All Suppliers"})}),e.jsxs(ie,{children:[e.jsx(V,{value:"all",children:"All Suppliers"}),f.map(g=>e.jsx(V,{value:g,children:g},g))]})]}),e.jsxs(me,{value:l,onValueChange:d,children:[e.jsx(le,{className:"w-[180px]",children:e.jsx(xe,{placeholder:"All Storage Types"})}),e.jsxs(ie,{children:[e.jsx(V,{value:"all",children:"All Storage Types"}),y.map(g=>e.jsx(V,{value:g,children:g},g))]})]}),e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-input bg-background px-3 py-2",children:[e.jsx(ht,{checked:c,onCheckedChange:m}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Overstocked only"})]}),e.jsxs(q,{variant:"outline",className:"ml-auto",children:[k.length," items"]})]}),e.jsx("div",{className:"soft-panel rounded-2xl border bg-card overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(he,{children:[e.jsx(ge,{children:e.jsxs(E,{className:"bg-muted/60",children:[e.jsx(L,{children:e.jsxs("button",{className:"flex items-center gap-2",onClick:()=>b("product"),type:"button",children:["Product ",O("product")]})}),e.jsx(L,{children:e.jsxs("button",{className:"flex items-center gap-2",onClick:()=>b("supplier"),type:"button",children:["Supplier ",O("supplier")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>b("invBal"),type:"button",children:["Inv Bal ",O("invBal")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>b("safetyStock"),type:"button",children:["Safety Stock ",O("safetyStock")]})}),e.jsx(L,{className:"text-right",children:e.jsxs("button",{className:"ml-auto flex items-center gap-2",onClick:()=>b("coverageDays"),type:"button",children:["Coverage Days ",O("coverageDays")]})})]})}),e.jsxs(ye,{children:[I.map(g=>{const P=j(g);return e.jsxs(E,{children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"font-medium",children:g.productCode||g.itemSapNo}),e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-[240px]",children:p(g.description)})]})}),e.jsx(D,{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:g.supplier||g.supplierCode}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g.warehouseLevel||"—"})]})}),e.jsx(D,{className:"text-right font-mono",children:g.invBal.toLocaleString()}),e.jsx(D,{className:"text-right font-mono",children:g.safetyStock.toLocaleString()}),e.jsx(D,{className:"text-right font-mono font-medium",children:P===null?"—":Math.ceil(P).toLocaleString()})]},g.id)}),I.length===0&&e.jsx(E,{children:e.jsx(D,{colSpan:5,className:"h-32 text-center text-muted-foreground",children:"No items found matching your filters."})})]})]})})})]})}const $s=x.lazy(()=>Oe(()=>import("./DemandCharts-CzDTzhTK.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(a=>({default:a.DemandCharts}))),zs=x.lazy(()=>Oe(()=>import("./POGenerator-CCGm8kQd.js"),__vite__mapDeps([7,1,2,5,4,6])).then(a=>({default:a.POGenerator})));x.lazy(()=>Oe(()=>import("./KPIOrbit-DZdMRtOU.js"),__vite__mapDeps([8,1,2,4])).then(a=>({default:a.KPIOrbit})));function qs(){const[a,t]=x.useState("upload"),[s,n]=x.useState([]),[o,l]=x.useState(null),[d,c]=x.useState(null),[m,h]=x.useState(null),[u,N]=x.useState([]),[r,p]=x.useState({supplier:"",warehouseLevel:"",alertStatus:[],searchQuery:""}),[f,y]=x.useState(!1),[j,C]=x.useState("forecast"),[b,O]=x.useState(null),[k,I]=x.useState([]),[g,P]=x.useState([]),[R,i]=x.useState(""),S=x.useCallback(M=>n(M),[]);x.useEffect(()=>{let M=!0;return(async()=>{const _=await Us();_&&M&&(l(_.processed),c(_.kpis),h(_.chartData),t("dashboard"),O(_.meta),I(_.rawFiles||[]));const Q=await Ue();M&&P(Q)})(),()=>{M=!1}},[]),x.useEffect(()=>{const M=B=>{s.length>0&&!o&&(B.preventDefault(),B.returnValue="")};return window.addEventListener("beforeunload",M),()=>window.removeEventListener("beforeunload",M)},[s.length,o]);const T=x.useMemo(()=>{const M={};return s.forEach(B=>{var U;const _=Object.keys(B.data)[0],Q=(U=B.data[_])==null?void 0:U[0];M[B.type]=Q?Object.keys(Q):[]}),M},[s]),F=async()=>{if(s.length<4){Se.error("Please upload all 4 required files");return}y(!0);try{const M=s.find(w=>w.type==="salesOrder"),B=s.find(w=>w.type==="inventoryBalance"),_=s.find(w=>w.type==="openPO"),Q=s.find(w=>w.type==="procurementForecast");if(!M||!B||!_||!Q)throw new Error("Missing required files");const U=Object.keys(M.data)[0],{pivot:W}=ls(M.data[U]||[]),Te=Object.keys(B.data)[0],ce=ds(B.data[Te]||[]),ee=Object.keys(_.data)[0],de=is(_.data[ee]||[]),A=de.totalMap,gt=de.breakdownMap,te=Q.data,ue=Object.keys(te),Ae=ue.find(w=>w.toLowerCase().includes("proc")||w.toLowerCase().includes("forecast")),Ie=ue.find(w=>{const je=w.toLowerCase();return je.includes("supplier")&&je.includes("code")||je.includes("supplier master")}),Re=ue.find(w=>w.toLowerCase().includes("po template")),yt=Ie?us(te[Ie]):[],G=Re?ms(te[Re]):null,Nt=(G==null?void 0:G.rows)||[],jt=G==null?void 0:G.headerMap,bt=Ae?te[Ae]:te[ue[0]]||[],se=ps(bt,ce,W,A,gt),Be={forecast:se,supplierCodes:yt,salesOrderPivot:W,inventoryBalance:ce,poTemplate:Nt,poTemplateHeaders:jt},_e=xs(se),Qe=fs(se,W);l(Be),c(_e),h(Qe);const Ee={id:`dataset-${Date.now()}`,createdAt:Date.now(),sourceFilename:Q.name,rowCount:se.length,label:R.trim()||void 0,columnSchema:T};await Fs({meta:Ee,files:s.map(w=>({name:w.name,type:w.type,uploadedAt:w.uploadedAt})),rawFiles:s.filter(w=>w.arrayBuffer).map(w=>({name:w.name,type:w.type,arrayBuffer:w.arrayBuffer})),processed:Be,kpis:_e,chartData:Qe}),O(Ee),I(s.filter(w=>w.arrayBuffer).map(w=>({name:w.name,type:w.type,arrayBuffer:w.arrayBuffer}))),P(await Ue()),t("dashboard"),Se.success(`Processed ${se.length} items successfully!`)}catch(M){Se.error(`Error: ${M instanceof Error?M.message:"Unknown error"}`)}finally{y(!1)}},z=()=>{t("upload"),n([]),l(null),c(null),h(null),N([]),p({supplier:"",warehouseLevel:"",alertStatus:[],searchQuery:""})},H=()=>(o==null?void 0:o.forecast.filter(M=>u.includes(M.id)))||[];return e.jsxs("div",{className:"app-shell soft-shell min-h-screen bg-background/80 text-foreground relative",children:[e.jsx(Rs,{}),e.jsxs("div",{className:"mx-auto flex max-w-7xl gap-6 px-6 py-6 relative z-10",children:[e.jsxs("aside",{className:"hidden w-64 flex-col gap-6 self-start lg:flex lg:sticky lg:top-6 lg:max-h-[calc(100vh-3rem)] lg:overflow-auto",children:[e.jsx("div",{className:"soft-panel rounded-2xl px-5 py-4 backdrop-blur-sm",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"truncate text-sm font-semibold tracking-wide leading-tight",children:"Compass Singapore"}),e.jsx("p",{className:"text-[10px] text-muted-foreground uppercase tracking-[0.2em] leading-tight",children:"Procurement Forecast"})]})})}),e.jsx("div",{className:"soft-panel rounded-2xl p-3",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("button",{className:`w-full rounded-xl px-4 py-3 text-left font-medium transition ${j==="forecast"?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted"}`,onClick:()=>C("forecast"),type:"button",children:"Forecast"}),e.jsx("button",{className:`w-full rounded-xl px-4 py-3 text-left font-medium transition ${j==="kpi"?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted"}`,onClick:()=>C("kpi"),type:"button",children:"KPI Coverage"}),e.jsx("button",{className:`w-full rounded-xl px-4 py-3 text-left font-medium transition ${j==="product"?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted"}`,onClick:()=>C("product"),type:"button",children:"Product Analysis"}),e.jsx("button",{className:`w-full rounded-xl px-4 py-3 text-left font-medium transition ${j==="analytics"?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted"}`,onClick:()=>C("analytics"),type:"button",children:"Analytics"}),e.jsx("button",{className:`w-full rounded-xl px-4 py-3 text-left font-medium transition ${j==="po"?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted"}`,onClick:()=>C("po"),type:"button",children:"Purchase Orders"})]})}),e.jsxs("div",{className:"soft-panel rounded-2xl p-5",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground",children:"Need help?"}),e.jsx("p",{className:"mt-2 text-sm font-medium",children:"Access documentation and process guides."}),e.jsx($,{className:"mt-4 w-full",variant:"outline",size:"sm",onClick:()=>window.open("/COMPASS_LOGIC.txt","_blank","noopener,noreferrer"),children:"Open Docs"})]})]}),e.jsxs("div",{className:"flex-1 space-y-6",children:[e.jsxs("header",{className:"soft-panel flex flex-wrap items-center justify-between gap-4 rounded-2xl px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-[0.2em]",children:"Internal Operational System"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Forecast Command Hub"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative hidden min-w-[240px] md:block",children:[e.jsx(Z,{placeholder:"Type here...",className:"pl-10"}),e.jsx(Me,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"})]}),a==="dashboard"&&e.jsxs($,{variant:"outline",size:"sm",onClick:z,children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"New Session"]}),e.jsx(Bs,{meta:b})]})]}),a==="upload"?e.jsxs("div",{className:"mx-auto flex w-full max-w-3xl flex-col gap-6",children:[e.jsxs("div",{className:"soft-panel rounded-3xl p-6 text-center",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Forecast Command Hub"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Upload your files to ignite a premium, futuristic forecast experience."})]}),e.jsxs("div",{className:"soft-panel space-y-6 rounded-2xl p-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Upload Your Files"}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Upload the 4 required Excel files to generate your procurement forecast"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Upload label (optional)"}),e.jsx(Z,{placeholder:"e.g., Week 2 Ops Run",value:R,onChange:M=>i(M.target.value)})]}),e.jsx(gs,{onFilesUploaded:S,uploadedFiles:s}),e.jsx($,{className:"w-full gradient-primary",size:"lg",disabled:s.length<4||f,onClick:F,children:f?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Process & Generate Forecast"]})})]})]}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[d&&e.jsx(ys,{kpis:d}),e.jsxs(ts,{value:j,onValueChange:M=>C(M),className:"space-y-4",children:[e.jsxs(ut,{className:"soft-panel grid w-full max-w-2xl grid-cols-5 rounded-2xl",children:[e.jsxs(Y,{value:"forecast",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Forecast"]}),e.jsxs(Y,{value:"kpi",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"KPI Coverage"]}),e.jsxs(Y,{value:"product",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Product Analysis"]}),e.jsxs(Y,{value:"analytics",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Analytics"]}),e.jsxs(Y,{value:"po",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Generate PO"]})]}),e.jsx(J,{value:"forecast",children:o&&e.jsx(Ls,{data:o.forecast,filters:r,onFiltersChange:p})}),e.jsx(J,{value:"kpi",children:o&&e.jsx(Vs,{data:o.forecast})}),e.jsx(J,{value:"product",children:o&&e.jsx(Ts,{data:o.forecast})}),e.jsx(J,{value:"analytics",children:e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading analytics…"}),children:m&&e.jsx($s,{chartData:m})})}),e.jsx(J,{value:"po",children:e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading PO generator…"}),children:o&&e.jsx(zs,{selectedItems:H(),supplierCodes:o.supplierCodes,allItems:o.forecast,poTemplateHeaders:o.poTemplateHeaders,auditContext:{files:s,rawFiles:k,processed:o,kpis:d,chartData:m,meta:b}})})})]}),e.jsx(_s,{history:g})]}),e.jsx("footer",{className:"soft-panel mt-6 rounded-2xl py-4",children:e.jsxs("div",{className:"text-center text-xs text-muted-foreground",children:["Compass Singapore Food Supply Chain © ",new Date().getFullYear()]})})]})]})]})}const Hs=({error:a,onReset:t})=>e.jsx("div",{className:"soft-shell flex min-h-screen items-center justify-center bg-background px-6 py-12 text-foreground",children:e.jsxs("div",{className:v("soft-panel w-full max-w-xl rounded-2xl p-6 text-center space-y-4"),children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Something went wrong"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"We hit an unexpected error. You can try again or reload the page."}),null,e.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[e.jsx($,{onClick:t,children:"Try again"}),e.jsx($,{variant:"outline",onClick:()=>window.location.reload(),children:"Reload page"})]})]})});class Ks extends x.Component{constructor(){super(...arguments);be(this,"state",{hasError:!1});be(this,"handleReset",()=>{var s,n;this.setState({hasError:!1,error:void 0}),(n=(s=this.props).onReset)==null||n.call(s)})}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,n){console.error("ErrorBoundary caught an error:",s,n)}render(){return this.state.hasError?this.props.fallback??e.jsx(Hs,{error:this.state.error,onReset:this.handleReset}):this.props.children}}Ct.createRoot(document.getElementById("root")).render(e.jsx(kt.StrictMode,{children:e.jsx(Ks,{children:e.jsx(qs,{})})}));export{q as B,ae as C,he as T,re as a,ne as b,oe as c,v as d,$ as e,ge as f,E as g,L as h,ye as i,D as j,ea as k,ta as l,sa as s};
